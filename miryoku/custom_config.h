// Copyright 2021 Manna Harbour
// https://github.com/manna-harbour/miryoku

#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include "miryoku_babel/miryoku_layer_list.h"

#define COMBO(NAME, BINDINGS, KEYPOS) \
  combo_##NAME { \
    timeout-ms = <50>; \
    bindings = <BINDINGS>; \
    key-positions = <KEYPOS>; \
    layers = <0>; \
  };
#define MACRO(NAME, KEYPOS) \
  MACRO_##NAME { \
    compatible = "zmk,behavior-macro"; \
    label = "ZM_macro_" #NAME; \
    #binding-cells = <0>; \
    wait-ms = <30>; \
    tap-ms = <40>; \
    bindings = <KEYPOS>; \
  };

/ {
  macros {
      MACRO(lb_r2_rm, &kp L &kp L)
      MACRO(rb_r4_im, &kp B)
  };
  combos {
      compatible = "zmk,combos";
      COMBO(lb_r2_rm, &macro_lb_r2_rm, 38 39)
      COMBO(rb_r4_im, &macro_rb_r4_im, 19 20)
      COMBO(nav_1, &mo U_NAV, 27 53)
      COMBO(nav_2, &mo U_NAV, 28 53)
  };
};

#define MIRYOKU_LAYER_BASE \
/* ╭───────────────────┬───────────────────┬───────────────────┬───────────────────┬───────────────────╮ ╭───────────────────┬───────────────────┬───────────────────┬───────────────────┬────────────────────╮ */ \
   &kp V,              &kp M,              &kp L,              &kp C,              &kp P,                &kp B,              &key_repeat,        &kp U,              &kp O,              &kp Q,                    \
/* ├───────────────────┼───────────────────┼───────────────────┼───────────────────┼───────────────────┤ ├───────────────────┼───────────────────┼───────────────────┼───────────────────┼────────────────────┤ */ \
   U_LT(U_SYM, S),     U_MTL(LALT, T),     U_MTL(LCTRL, R),    U_MTL(LSHFT, D),    &kp Y,                &kp F,              U_MTR(LSHFT, N),    U_MTR(LCTRL, E),    U_MTR(RALT, A),     U_LT(U_MOUSE, I),         \
/* ├───────────────────┼───────────────────┼───────────────────┼───────────────────┼───────────────────┤ ├───────────────────┼───────────────────┼───────────────────┼───────────────────┼────────────────────┤ */ \
   U_MTL(LGUI, X),     U_LT(U_BUTTON, K),  &kp J,              &kp G,              &kp W,                &kp Z,              &kp H,              &kp COMMA,          U_LT(U_BUTTON, DOT),U_MTR(LGUI, SEMI),        \
/* └───────────────────┴───────────────────┼───────────────────┼───────────────────┼───────────────────┤ ├───────────────────┼───────────────────┼───────────────────┼───────────────────┴────────────────────╯ */ \
   U_NP,U_NP,                              U_LT(U_FUN, DEL),   U_LT(U_NUM, BSPC),  U_LT(U_SYM, RET),     U_LT(U_MOUSE, TAB), U_LT(U_NAV, SPACE), U_LT(U_MEDIA, ESC),                                  U_NP,U_NP    \
/*                                         ╰───────────────────┴───────────────────┴───────────────────╯ ╰───────────────────┴───────────────────┴───────────────────╯                                          */

#define MIRYOKU_LAYER_NAV \
/* ╭───────────────────┬───────────────────┬───────────────────┬───────────────────┬───────────────────╮ ╭───────────────────┬───────────────────┬───────────────────┬───────────────────┬────────────────────╮ */ \
   U_BOOT,             &u_to_U_TAP,        &u_to_U_EXTRA,      &u_to_U_BASE,       U_NA,                 U_RDO,              U_PST,              U_CPY,              U_CUT,              U_UND,                    \
/* ├───────────────────┼───────────────────┼───────────────────┼───────────────────┼───────────────────┤ ├───────────────────┼───────────────────┼───────────────────┼───────────────────┼────────────────────┤ */ \
   &kp LGUI,           &kp LALT,           &kp LCTRL,          &kp LSHFT,          U_NA,                 &u_caps_word,       &kp LEFT,           &kp DOWN,           &kp UP,             &kp RIGHT,                \
/* ├───────────────────┼───────────────────┼───────────────────┼───────────────────┼───────────────────┤ ├───────────────────┼───────────────────┼───────────────────┼───────────────────┼────────────────────┤ */ \
   U_NA,               &kp RALT,           &u_to_U_NUM,        &u_to_U_NAV,        U_NA,                 &kp INS,            &kp HOME,           &kp PG_DN,          &kp PG_UP,          &kp END,                  \
/* └───────────────────┴───────────────────┼───────────────────┼───────────────────┼───────────────────┤ ├───────────────────┼───────────────────┼───────────────────┼───────────────────┴────────────────────╯ */ \
   U_NP,U_NP,                              &kp DEL,            &kp BSPC,           &kp RET,              U_NA,               U_NA,               U_NA,                                                U_NP,U_NP    \
/*                                         ╰───────────────────┴───────────────────┴───────────────────╯ ╰───────────────────┴───────────────────┴───────────────────╯                                          */

#define MIRYOKU_LAYER_NUM \
/* ╭───────────────────┬───────────────────┬───────────────────┬───────────────────┬───────────────────╮ ╭───────────────────┬───────────────────┬───────────────────┬───────────────────┬────────────────────╮ */ \
   U_BOOT,             &u_to_U_TAP,        &u_to_U_EXTRA,      &u_to_U_BASE,       U_NA,                 &kp LBKT,           &kp N7,             &kp N8,             &kp N9,             &kp RBKT,                 \
/* ├───────────────────┼───────────────────┼───────────────────┼───────────────────┼───────────────────┤ ├───────────────────┼───────────────────┼───────────────────┼───────────────────┼────────────────────┤ */ \
   &kp LGUI,           &kp LALT,           &kp LCTRL,          &kp LSHFT,          U_NA,                 &kp EQUAL,          &kp N4,             &kp N5,             &kp N6,             &kp SLASH,                \
/* ├───────────────────┼───────────────────┼───────────────────┼───────────────────┼───────────────────┤ ├───────────────────┼───────────────────┼───────────────────┼───────────────────┼────────────────────┤ */ \
   U_NA,               &kp RALT,           &u_to_U_NAV,        &u_to_U_NUM,        U_NA,                 &kp BSLH,           &kp N1,             &kp N2,             &kp N3,             &kp GRAVE,                \
/* └───────────────────┴───────────────────┼───────────────────┼───────────────────┼───────────────────┤ ├───────────────────┼───────────────────┼───────────────────┼───────────────────┴────────────────────╯ */ \
   U_NP,U_NP,                              U_NA,               U_NA,               U_NA,                 &kp MINUS,          &kp N0,             &kp DOT,                                             U_NP,U_NP    \
/*                                         ╰───────────────────┴───────────────────┴───────────────────╯ ╰───────────────────┴───────────────────┴───────────────────╯                                          */
